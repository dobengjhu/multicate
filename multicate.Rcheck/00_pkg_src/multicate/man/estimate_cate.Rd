% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/estimate_cate.R
\name{estimate_cate}
\alias{estimate_cate}
\title{Estimate Heterogeneous Treatment Effects Across Multiple Studies}
\usage{
estimate_cate(
  trial_tbl,
  estimation_method = c("slearner", "causalforest"),
  aggregation_method = c("studyindicator", "ensembleforest"),
  study_col,
  treatment_col,
  outcome_col,
  covariate_col = NULL,
  drop_col = NULL,
  ...
)
}
\arguments{
\item{trial_tbl}{tbl. A tbl containing columns for treatment, outcome, study ID, and any
additional covariates of interest. All study data must be included in single tbl. Note that
only two treatments can be considered and treatment must be coded as 0/1 (numeric).}

\item{estimation_method}{string. Single-study methods for estimating CATE (tau) for each
observation. Available methods are "slearner" (using Bayesian Additive Regression Trees),
and "causalforest".}

\item{aggregation_method}{string. Method for aggregating results across studies Available methods
are:
\itemize{
\item "studyindicator": Pool all data together but keep study ID as an indicator variable and
includes them as covariates in the single-study method selected in \code{estimation_method}.
\item "ensembleforest": Fit the \code{estimation_method} within each study, apply each model to all
individuals across all studies, then fit ensemble random forest to augmented data.
}}

\item{study_col}{string. Name of the column in \code{trial_tbl} with study ID.}

\item{treatment_col}{string. Name of the column in \code{trial_tbl} with treatment assignment.}

\item{outcome_col}{string. Name of the column in \code{trial_tbl} with outcome values.}

\item{covariate_col}{character vector. Name(s) of columns in \code{trial_tbl} to be included as
model covariates. Defaults to NULL.}

\item{drop_col}{character vector. Name(s) of columns in \code{trial_tbl} to be excluded from
model covariates. Defaults to NULL.}

\item{...}{Arguments to be passed to \code{estimation_method} and/or \code{aggregation_method}. Note the
following exceptions:
\itemize{
\item \code{estimation_method} = "slearner"
\itemize{
\item \link[dbarts:bart]{dbarts::bart()} argument \code{keeptrees} set to TRUE
\item \link[dbarts:bart]{dbarts::bart()} argument \code{verbose} set to FALSE when \code{aggregation_method} is
"ensembleforest"
}
\item \code{aggregation_method} = "ensembleforest"
\itemize{
\item \link[ranger:ranger]{ranger::ranger()} argument \code{importance} set to "impurity"
\item \link[ranger:ranger]{ranger::ranger()} argument \code{keep.inbag} set to TRUE
}
}}
}
\value{
An object of class "cate" is a list containing the following elements:
\itemize{
\item \code{estimation_method}: the type of estimation method used
\item \code{aggregation_method}: the type of aggregation method used
\item \code{model}: \code{trial_tbl} with additional columns
\itemize{
\item \code{tau_hat}: conditional average treatment effect for each observation
\item \code{variance_estimates}: variance estimate for each tau_hat (not available when
\code{aggregation_method} set to "ensembleforest)
}
\item \code{var_importance}: a measure of how involved each variable was in creating the forest
(see grf and ranger documentation for more details on calculation)
\item \code{study_col}: name of study ID column
\item \code{treatment_col}: name of treatment column
\item \code{outcome_col}: name of outcome column
\item \code{covariate_col}: name(s) of covariate columns
\item \code{estimation_object}: object from \link[grf:causal_forest]{grf::causal_forest}
or \link[dbarts:bart]{dbarts::bart}, according to the \code{estimation_method} selected.
}
}
\description{
\code{estimate_cate} is used to estimate conditional average treatment effect (CATE) from multiple
studies.
}
\details{
The resulting CATEs are of the form: E(Y(1) - Y(0)|X), where X includes covariates included in
the \code{covariate_col} argument. For a continuous outcome, this is the difference in the means
between treatment groups for a particular covariate profile X. For a binary outcome, this
translates to an estimate of the risk difference between the two treatment groups for X.

This function relies on two methods: an estimation method and an aggregation method. Estimation
methods include an S-learner with BART (Hill, 2011; Künzel, 2019), and a causal forest (Athey et
al., 2019). Details on each approach can be found in the respective papers, as well as the R
packages \code{dbarts} and \code{grf}. Aggregation methods include the pooling with trial indicator method
and the ensemble forest (Brantner et al., 2024). All methods included in this package performed
well in simulations across various settings of cross-study heterogeneity and functional forms of
the CATE (Brantner et al., 2024).

Variance estimates are available for all estimation methods when the pooling with trial indicator
aggregation method is used. Variance estimates are not yet available for the ensemble forest.

Data from the studies being combined can come from randomized clinical trials, observational
studies, or both. The estimation methods can inherently handle confounding in treatment
assignment, and users can allow the methods to automatically address confounding.
If desired, propensity scores can be separately estimated and included in one of two ways: as a
covariate for S-learner with BART, or as the \code{W.hat} argument in the causal forest (see \code{grf}
documentation).
}
\references{
Hill, J. L. (2011). Bayesian Nonparametric Modeling for Causal Inference.
\emph{Journal of Computational and Graphical Statistics, 20}(1), 217–240.
\href{http://www.tandfonline.com/doi/abs/10.1198/jcgs.2010.08162}{DOI:10.1198/jcgs.2010.08162}

Künzel, S. R., Sekhon, J. S., Bickel, P. J., & Yu, B. (2019). Metalearners for estimating
heterogeneous treatment effects using machine learning.
\emph{Proceedings of the National Academy of Sciences, 116}(10), 4156–4165.

Athey, S., Tibshirani, J., & Wager, S. (2019). Generalized random forests.
\emph{The Annals of Statistics, 47}(2), 1148–1178.

Brantner, C. L., Nguyen, T. Q., Tang, T., Zhao, C., Hong, H., & Stuart, E. A. (2024).
Comparison of methods that combine multiple randomized trials to estimate heterogeneous treatment
effects. \emph{Statistics in Medicine.}
}
